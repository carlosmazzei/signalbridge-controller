{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Initialize Submodules",
            "type": "shell",
            "command": "git",
            "args": [
                "submodule",
                "update",
                "--init",
                "--recursive"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": false
            },
            "problemMatcher": [],
            "detail": "Initialize all git submodules recursively"
        },
        {
            "label": "Update Submodules",
            "type": "shell",
            "command": "git",
            "args": [
                "submodule",
                "update",
                "--recursive",
                "--remote"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": false
            },
            "problemMatcher": [],
            "detail": "Update all submodules to their latest commits"
        },
        {
            "label": "CMake Configure",
            "type": "shell",
            "command": "cmake",
            "args": [
                ".."
            ],
            "options": {
                "cwd": "${workspaceFolder}/build"
            },
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": false
            },
            "problemMatcher": [
                "$gcc"
            ],
            "detail": "Configure CMake build system",
            "dependsOn": "Create Build Directory"
        },
        {
            "label": "Generate Documentation",
            "type": "shell",
            "command": "doxygen",
            "args": [
                "Doxyfile"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": false
            },
            "problemMatcher": [],
            "detail": "Generate Doxygen documentation"
        },
        {
            "label": "uncrustify",
            "type": "shell",
            "command": "uncrustify",
            "args": [
                "-c",
                "${workspaceFolder}/uncrustify.cfg",
                "${file}",
                "--replace",
                "--no-backup"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": false
            },
            "problemMatcher": [],
            "detail": "Format current file with uncrustify code formatter"
        },
        {
            "label": "uncrustify all C/C++ files",
            "type": "shell",
            "command": "find",
            "args": [
                "${workspaceFolder}/src",
                "${workspaceFolder}/include",
                "-name",
                "*.c",
                "-o",
                "-name",
                "*.cpp",
                "-o",
                "-name",
                "*.h",
                "-o",
                "-name",
                "*.hpp",
                "|",
                "xargs",
                "uncrustify",
                "-c",
                "${workspaceFolder}/uncrustify.cfg",
                "--replace",
                "--no-backup"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": false
            },
            "problemMatcher": [],
            "detail": "Format all C/C++ files in src/ and include/ directories with uncrustify"
        },
        {
            "label": "Run Cppcheck (Full Analysis)",
            "type": "shell",
            "command": "${workspaceFolder}/scripts/run_cppcheck.sh",
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": true
            },
            "problemMatcher": {
                "owner": "cppcheck",
                "source": "cppcheck",
                "fileLocation": "absolute",
                "severity": "info",
                "pattern": {
                    "regexp": "^(.*):(\\d+):(\\d+): (error|warning|information|style|performance|portability|note): (.*)\\s+\\[(.*)\\]$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5,
                    "code": 6
                }
            },
            "detail": "Run comprehensive cppcheck analysis with MISRA C:2012 addon - results appear in Problems panel"
        },
        {
            "label": "Run Cppcheck (Quick Check)",
            "type": "shell",
            "command": "${workspaceFolder}/scripts/cppcheck_simple.sh",
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": true
            },
            "problemMatcher": {
                "owner": "cppcheck",
                "source": "cppcheck",
                "fileLocation": "absolute",
                "severity": "info",
                "pattern": {
                    "regexp": "^(.*):(\\d+):(\\d+): (error|warning|information|style|performance|portability|note): (.*)\\s+\\[(.*)\\]$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5,
                    "code": 6
                }
            },
            "detail": "Run simplified cppcheck analysis with basic MISRA rules"
        },
        {
            "label": "Run Cppcheck (Single File)",
            "type": "shell",
            "command": "cppcheck",
            "args": [
                "--std=c11",
                "--enable=all",
                "--force",
                "--template={file}:{line}: {severity}: {message} [{id}]",
                "--suppressions-list=${workspaceFolder}/.cppcheck_suppressions",
                "--addon=${workspaceFolder}/misra.json",
                "-DportBYTE_ALIGNMENT=8",
                "-DRP2040=1",
                "-D__ARM_ARCH_6M__=1",
                "-DconfigNUM_CORES=2",
                "-I${workspaceFolder}/include",
                "-I${workspaceFolder}/lib/pico-sdk/src/common/pico_stdlib/include",
                "-I${workspaceFolder}/lib/FreeRTOS-Kernel/include",
                "--force-include=${workspaceFolder}/include/FreeRTOSConfig.h",
                "${file}"
            ],
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": true
            },
            "problemMatcher": {
                "owner": "cppcheck",
                "source": "cppcheck",
                "fileLocation": "absolute",
                "severity": "info",
                "pattern": {
                    "regexp": "^(.*):(\\d+):(\\d+): (error|warning|information|style|performance|portability|note): (.*)\\s+\\[(.*)\\]$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5,
                    "code": 6
                }
            },
            "detail": "Run cppcheck on the currently open file"
        }
    ]
}